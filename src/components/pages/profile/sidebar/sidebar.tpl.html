<div class="sidebar">

    <div class="sidebar__content">

        <div class="sidebar__content-top" :class="{ 'collapse': !toggleUserinfo }">

            <div class="sidebar__content-logo">
                <router-link :to="{ path: '/'}"><img :src="logo" alt=""></router-link>
            </div>

            <div class="sidebar__content-user" :class="{ 'collapse': !toggleUserinfo }">
                <span v-on:click="openRoute('Editdata')" class="name">{{ authenticated ? user.username : $t('sidebar.youraccount') }}</span>
                <span class="resize" v-if="authenticated" :class="{ 'collapse': !toggleUserinfo }" v-on:click="toggleUserinfo = !toggleUserinfo"></span>
                <p v-if="authenticated">{{ $t('sidebar.currentcredits') }}</p>
                <span v-if="authenticated" class="credits">{{ user.credits }}</span>
                <router-link v-if="authenticated && !InSession" class="btn btn-fa fa-credit-card btn-small btn-black" :to="{ name: 'Payment' }"></router-link>
                <a v-if="authenticated && InSession" id="CTApayment1" class="btn btn-fa fa-credit-card btn-small btn-black" v-on:click="openTab('/payment/', 'width=830,height=630')"></a>
                <ul class="usp" v-if="!authenticated">
                    <li v-t="'sidebar.register.usp-1'"></li>
                    <li v-t="'sidebar.register.usp-2'"></li>
                    <li v-t="'sidebar.register.usp-3'"></li>
                </ul>
                <a v-if="!authenticated" v-on:click="openModal('register')" class="btn btn-green btn-small">{{ $t('modals.login.register') }}</a>
            </div>

            <div class="sidebar__content-search form">
                <form v-on:submit.prevent="search()">
                    <input type="text" class="searching" name="search" v-model="query.search" :placeholder="$t('nav.search.input')">
                    <button class="fa fa-search"></button>
                </form>
            </div>

            <ul class="sidebar__content-filters">
                <li v-t="'sidebar.recommended'" v-if="defaultCategory === 'recommended'" :class="{ 'active': category === 'recommended' }" v-on:click="setCategory('recommended')"></li>
                <li v-t="'sidebar.teasers'" v-if="!isVoyeurActive" :class="{ 'active': category === 'teasers' }" v-on:click="setCategory('teasers')"></li>
                <li v-t="'sidebar.peek'" :class="{ 'active': category === 'peek' }" v-on:click="setCategory('peek')"></li>
                <li v-t="'sidebar.voyeur'" v-if="isVoyeurActive" :class="{ 'active': category === 'voyeur' }" v-on:click="setCategory('voyeur')"></li>
                <li class="favo" :class="{ 'active': category === 'favourites' }" v-on:click="setCategory('favourites')">
                    <i aria-hidden="true" class="fa fa-star"></i>
                </li>
            </ul>
            
        </div>

        <div class="sidebar__content-bottom" :class="{ 'collapse': !toggleUserinfo }">

            <ul class="sidebar__performers nomar nopad" v-on:scroll="onScroll" :class="{ 'collapse': !toggleUserinfo }">

                <!-- Performerlist -->
                <li class="sidebar__performer" v-if="category !== 'voyeur' && performers" v-for="performer in performers" v-on:click="goToPerformer(performer, category)">
                    <div class="sidebar__performer-image col-xs-5 nopad">
                        <img :src="getAvatarImage(performer, 'small')" />
                        <span class="status" :class="getPerformerStatus(performer)"></span>
                        <div class="sidebar__performer-services" v-if="isOutOfSession(performer.performerStatus)">
                            <i v-for="service in services" v-if="hasService(performer.id, service)" :class="'fa fa-' + service"></i>
                        </div>
                    </div>
                    <div class="sidebar__performer-info col-xs-7">
                        <h3>{{ performer.nickname }}</h3>
                        <p>{{ $t('sidebar.age', { age: performer.age }) }}</p>
                        <p class="view"><span v-t="category !== 'peek' ? 'sidebar.view' : 'sidebar.peek'"></span> <i class="fa fa-chevron-right"></i></p>
                    </div>
                </li>

                <!-- Voyeurlist -->
                <li class="sidebar__voyeur" v-if="category === 'voyeur' && voyeurTiles" v-for="(tile, index) in voyeurTiles">

                    <div class="sidebar__voyeur-click" v-on:click="swap(tile.performer)"></div>
                    <div>
                        <!-- <jsmpeg
                            :wowza="tile.streamData.wowza"
                            :playStream="tile.streamData.playStream"
                            :muted="true">
                        </jsmpeg> -->
                        <!-- <nanocosmos
                        :wowza="tile.streamData.wowza"
                        :interactive="false"
                        :playStream="tile.streamData.playStream"
                        :muted="true">
                        </nanocosmos> -->
                        <component v-if="tile.streamData" :is="streamTransportType(tile.performer)"
                                   :wowza="playServer(tile.performer, tile.streamData)"
                                   :interactive="false"
                                   :playStream="tile.streamData.playStream"
                                   :playToken="tile.streamData.playToken"
                                   v-on:error="voyeurPlayerError(index)"
                                   :muted="true"
                                   :tile="index"
                                   :isMain="false">
                        </component>
                    </div>
                    {{ tile.performer }}
                    {{ tile.streamData }}
                    {{ playServer(tile.performer, tile.streamData) }}
                    {{ streamTransportType(tile.performer) }}
                    <div class="sidebar__voyeur-misc">
                        <span class="sidebar__voyeur-misc-advert">{{ performer(tile.performer) != undefined ? performer(tile.performer).advertId : 'Error' }}</span>
                        <span class="sidebar__voyeur-misc-favorite" v-on:click="toggleFavourite(tile.performer)">
                            <i class="fa fa-star" :class="{ 'is-favourite': performer(tile.performer) == undefined ? false : performer(tile.performer).isFavourite }"></i>
                        </span>
                    </div>
                    <div class="sidebar__voyeur-hover">
                        <a class="btn btn-black btn-small btn-icon" v-if="performer(tile.performer).performerStatus === 'AVAILABLE' && performer(tile.performer).performer_services.cam" v-on:click="startVideoChat(tile.performer)">
                            <i class="online"></i>{{ $t('voyeur.now1on1') }}
                        </a>
                        <a class="btn btn-black btn-small btn-icon" v-if="performer(tile.performer).performerStatus !== 'AVAILABLE' && performer(tile.performer).performer_services.cam"  v-on:click="reserve(tile.performer)">
                            <i class="reserve"></i>{{ isReserved(tile.performer) ? $t('voyeur.cancelReservation') : $t('voyeur.reserve') }}
                        </a>
                    </div>
                </li>

                <!-- No performers -->
                <li class="sidebar__performer" :class="{ 'active': displaySidebar }" v-if="performers.length === 0 && category !== 'voyeur'">
                    <h3 class="text-center" v-t="'sidebar.noperformers'"></h3>
                </li>
            </ul>

        </div>

    </div>

    <div class="sidebar__toggle hidden-md hidden-lg">
        <div class="sidebar__toggle-icon black">
            <router-link :to="{ path: '/'}"><i class="fa fa-home" aria-hidden="true"></i></router-link>
        </div>
        <div class="sidebar__toggle-icon" v-on:click="toggleSidebar">
            <i class="fa" :class="{ 'fa-angle-double-left': displaySidebar, 'fa-angle-double-right': !displaySidebar }" aria-hidden="true"></i>
        </div>
    </div>
</div>
