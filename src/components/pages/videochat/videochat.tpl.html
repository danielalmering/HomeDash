<div class="videochat">
    <div class="videochat__screen">
        <div class="videochat__screen-object">
            <component :key="performer.id" :is="
            streamTransportType"
                v-on:stateChange="viewerStateChange"
                v-on:error="viewerError"
                :wowza="playServer"
                :playStream="playStream"
                :playToken="playToken"
                :isSwitching="isSwitching"
                :muted="sessionType == 'PEEK'"
                :debug="true"
                >
            </component>
        </div>
    </div>
    <div class="videochat__broadcast" v-if="broadcastType != 'none'">
        <div class="videochat__broadcast-object" v-if="broadcasting.cam">
            <component :is="broadcastType"
                v-on:stateChange="broadcastStateChange"
                v-on:error="broadcastError"
                :wowza="castServer"
                :publishStream="publishStream"
                :publishToken="publishToken"
                :mic="broadcasting.mic"
                :cam="broadcasting.cam"
                :videoCodec="broadcasting.videoCodec"
                :quality="1" 
                :debug="false">
            </component>
        </div>

        <div class="videochat__broadcast-buttons" v-if="broadcasting.cam">
            <a v-on:click="toggleMic" v-if="userHasMic" class="fa fa-microphone" :class="{ active:broadcasting.mic }"></a>
            <a v-on:click="toggleSettings" class="fa fa-cogs" :class="{ active:broadcasting.settings }"></a>
        </div>

        <div class="videochat__devices" v-if="broadcasting.settings">
            <div class="videochat__devices-item">
                <i class="fa fa-video-camera"></i>
                <select v-model="broadcasting.cam" v-on:change="setCamera">
                    <option v-for="camera in cameras" :value="camera.id ? camera.id : camera.name">
                        {{ camera.name }}
                    </option>
                </select>
            </div>
            <div class="videochat__devices-item" v-if="userHasMic">
                <i class="fa fa-microphone"></i>
                <select v-model="broadcasting.mic" v-on:change="setMicrophone">
                    <option v-for="mic in microphones" :value="mic.id ? mic.id : mic.name">
                        {{ mic.name }}
                    </option>
                </select>
            </div>
            <p style="display: none" v-for="message in stateMessages">{{ message }}</p>
        </div>

    </div>

    <div class="videochat__gotoservice visible-lg">
        <div class="videochat__gotoservice-start-stop" v-if="canSwitchToVideoCall" v-on:click="startCalling">{{ $t('videochat.videocall-on') }}</div>
        <div class="videochat__gotoservice-start-stop" v-if="sessionType === 'VIDEOCALL' && paymentMethod == 'IVR'" v-on:click="stopCalling">{{ $t('videochat.videocall-off') }}</div>
    </div>

    <div class="videochat__close" v-on:click="close"><i class="fa fa-times"></i></div>

    <div class="videochat__chat">

        <div class="videochat__controls" v-if="performer">
            <span class="videochat__controls-name">{{ performer.nickname }}
                <i>({{ performer.advertId }})</i>
            </span>

            <div class="videochat__controls-btns">
                <a v-on:click="toggleCam" v-if="sessionType != 'PEEK' && broadcastType != 'none'" class="fa fa-video-camera" :class="{ active:broadcasting.cam }" >
                    <i class="tooltip" v-t="'videochat.webcam-on'"></i>
                </a>
                <a v-on:click="performer.isSubscribed ? removeSubscriptions(performer) : addSubscriptions(performer)" class="fa fa fa-bell" :class="{ active:performer.isSubscribed }" >
                    <i class="tooltip">{{ performer.isSubscribed ? $t('profile.subscribe-remove') : $t('profile.subscribe-add') }}</i>
                </a>
                <a v-on:click="toggleFavourite" class="fa fa-star" :class="{ active:performer.isFavourite }" >
                    <i class="tooltip">{{ performer.isFavourite ? $t('profile.favorite-remove') : $t('profile.favorite-add') }}</i>
                </a>
                <a v-on:click="openTab('/payment/', 'width=830,height=630')" id="CTApayment2" class="fa fa-credit-card" >
                    <i class="tooltip">{{ $t('payment.paying') }}</i>
                </a>
            </div>
        </div>

        <chat v-if="sessionType != 'PEEK'" :performer-name="performer ? performer.nickname : ''" :user-name="displayName"></chat>
    </div>

    <confirmation v-if="isSwitchModal" :type="'dialog'" :title="'videochat.switchpeek'" v-on:accept="switchPeek" v-on:cancel="cancelSwitch"></confirmation>
    <confirmation v-if="askToLeave" :type="'dialog'" :title="'videochat.leaving'" v-on:accept="leave" v-on:cancel="stay"></confirmation>
</div>
